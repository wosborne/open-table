<div class="container">
  <nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
      <li><%= link_to "Dashboard", account_dashboard_path(current_account) %></li>
      <li><%= link_to "External Accounts", account_external_account_path(current_account, @external_account) %></li>
      <li class="is-active"><a href="#" aria-current="page">Edit Payment Policy</a></li>
    </ul>
  </nav>

  <h1 class="title">Edit Payment Policy</h1>
  <h2 class="subtitle">eBay Account: <%= @external_account.ebay_display_name || @external_account.ebay_username %></h2>

  <%= form_with model: [@external_account, @payment_policy], 
                url: account_external_account_payment_policy_path(current_account, @external_account, @payment_policy),
                method: :patch,
                local: true,
                class: "box" do |f| %>
    
    <% if @payment_policy.errors.any? %>
      <div class="notification is-danger">
        <h4>Please fix the following errors:</h4>
        <ul>
          <% @payment_policy.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.hidden_field :marketplace_id, value: "EBAY_GB" %>

    <div class="field">
      <%= f.label :name, class: "label" %>
      <div class="control">
        <%= f.text_field :name, class: "input", placeholder: "Policy Name" %>
      </div>
      <p class="help">Enter a unique name for this payment policy</p>
    </div>

    <div class="field">
      <%= f.label :category_type, "Category Type", class: "label" %>
      <div class="control">
        <div class="select is-fullwidth">
          <%= f.select :category_type,
                       [["All Categories (Excluding Motors)", "ALL_EXCLUDING_MOTORS_VEHICLES"], 
                        ["Motor Vehicles", "MOTORS_VEHICLES"]],
                       { selected: "ALL_EXCLUDING_MOTORS_VEHICLES" } %>
        </div>
      </div>
      <p class="help">Select which category types this policy applies to</p>
    </div>

    <div class="field">
      <div class="control">
        <label class="checkbox">
          <%= f.check_box :immediate_pay, { checked: false }, "1", "0" %>
          Require immediate payment
        </label>
      </div>
      <p class="help">Buyers must pay immediately when purchasing</p>
    </div>

    <div class="field is-grouped">
      <div class="control">
        <%= f.submit "Update Payment Policy", class: "button is-primary" %>
      </div>
      <div class="control">
        <%= link_to "Cancel", account_external_account_path(current_account, @external_account), class: "button" %>
      </div>
    </div>
  <% end %>
</div>