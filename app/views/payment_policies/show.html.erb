<div class="container">
  <nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
      <li><%= link_to "Dashboard", account_dashboard_path(current_account) %></li>
      <li><%= link_to "External Accounts", account_external_account_path(current_account, @external_account) %></li>
      <li class="is-active"><a href="#" aria-current="page">Payment Policy</a></li>
    </ul>
  </nav>

  <h1 class="title"><%= @payment_policy.name %></h1>
  <h2 class="subtitle">eBay Account: <%= @external_account.ebay_display_name || @external_account.ebay_username %></h2>

  <div class="box">
    <div class="field">
      <label class="label">Policy Name</label>
      <div class="content">
        <%= @payment_policy.name %>
      </div>
    </div>

    <div class="field">
      <label class="label">Category Default</label>
      <div class="content">
        <%= @payment_policy.category_default? ? "Yes" : "No" %>
      </div>
    </div>

    <div class="field">
      <label class="label">Immediate Pay</label>
      <div class="content">
        <%= @payment_policy.immediate_pay? ? "Yes" : "No" %>
      </div>
    </div>

    <% if @payment_policy.payment_methods.present? %>
      <div class="field">
        <label class="label">Payment Methods</label>
        <div class="content">
          <% @payment_policy.payment_methods.each do |method| %>
            <%= method %><br>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @payment_policy.payment_instructions.present? %>
      <div class="field">
        <label class="label">Payment Instructions</label>
        <div class="content">
          <%= @payment_policy.payment_instructions %>
        </div>
      </div>
    <% end %>

    <% if @payment_policy.deposit_details.present? %>
      <h3 class="title is-5">Deposit Details</h3>
      
      <% if @payment_policy.deposit_amount %>
        <div class="field">
          <label class="label">Deposit Amount</label>
          <div class="content">
            <%= @payment_policy.deposit_currency %> <%= @payment_policy.deposit_amount %>
          </div>
        </div>
      <% end %>

      <% if @payment_policy.full_payment_due_in %>
        <div class="field">
          <label class="label">Full Payment Due In</label>
          <div class="content">
            <%= @payment_policy.full_payment_due_in %> days
          </div>
        </div>
      <% end %>
    <% end %>

    <% ebay_attrs = @payment_policy.ebay_attributes %>
    <% if ebay_attrs.present? && ebay_attrs["categoryTypes"].present? %>
      <div class="field">
        <label class="label">Category Types</label>
        <div class="content">
          <% ebay_attrs["categoryTypes"].each do |category| %>
            <%= category["name"] %><%= " (default)" if category["default"] %><br>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="field is-grouped">
      <% if @payment_policy.persisted? %>
        <div class="control">
          <%= link_to "Edit", edit_account_external_account_payment_policy_path(current_account, @external_account, @payment_policy), class: "button is-primary", data: { turbo_frame: "_top" } %>
        </div>
        <div class="control">
          <%= link_to "Delete", account_external_account_payment_policy_path(current_account, @external_account, @payment_policy), 
                      class: "button is-danger", 
                      data: { 
                        turbo_method: :delete,
                        turbo_frame: "_top",
                        turbo_confirm: "Are you sure you want to delete this payment policy? This will also delete it from eBay and cannot be undone." 
                      } %>
        </div>
      <% else %>
        <% if @payment_policy.ebay_policy_id.present? %>
          <div class="control">
            <a href="https://www.ebay.co.uk/bp/pay/edit/<%= @payment_policy.ebay_policy_id %>" target="_blank" class="button is-primary">
              Edit on eBay
            </a>
          </div>
        <% end %>
      <% end %>
      <div class="control">
        <%= link_to "Back", account_external_account_path(current_account, @external_account), class: "button", data: { turbo_frame: "_top" } %>
      </div>
    </div>
  </div>
</div>